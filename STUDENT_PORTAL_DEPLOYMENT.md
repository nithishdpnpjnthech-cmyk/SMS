# Student Login Portal - Deployment Guide\n\n## Overview\nThis document provides step-by-step instructions to deploy the Student Login Portal safely without affecting existing functionality.\n\n## Database Setup\n\n### 1. Create Required Tables\nRun the SQL script to create student portal tables:\n\n```bash\nmysql -u [username] -p [database_name] < student-portal-setup.sql\n```\n\nOr execute manually:\n```sql\n-- Student Portal Credentials Table\nCREATE TABLE IF NOT EXISTS student_portal_credentials (\n  id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),\n  student_id VARCHAR(36) NOT NULL UNIQUE,\n  username VARCHAR(50) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,\n  is_active BOOLEAN DEFAULT TRUE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  created_by VARCHAR(36) NOT NULL,\n  last_login TIMESTAMP NULL,\n  FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,\n  FOREIGN KEY (created_by) REFERENCES users(id),\n  INDEX idx_student_portal_username (username),\n  INDEX idx_student_portal_student_id (student_id)\n);\n\n-- Student Uniforms Table\nCREATE TABLE IF NOT EXISTS student_uniforms (\n  id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),\n  student_id VARCHAR(36) NOT NULL,\n  issued BOOLEAN DEFAULT FALSE,\n  issue_date DATE NULL,\n  notes TEXT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,\n  UNIQUE KEY unique_student_uniform (student_id)\n);\n```\n\n### 2. Verify Table Creation\n```sql\nSHOW TABLES LIKE 'student_%';\nDESCRIBE student_portal_credentials;\nDESCRIBE student_uniforms;\n```\n\n## Backend Deployment\n\n### 1. Restart Server\nThe new APIs are already integrated into the existing routes. Simply restart the server:\n\n```bash\n# Development\n$env:NODE_ENV='development'; npx tsx server/index.ts\n\n# Production\nnpm run build\nnpm start\n```\n\n### 2. Verify API Endpoints\nTest the new endpoints:\n\n```bash\n# Test student login (should fail without credentials)\ncurl -X POST http://localhost:5000/api/student/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"test\",\"password\":\"test\"}'\n\n# Test admin credential management (requires admin auth)\ncurl -X GET http://localhost:5000/api/admin/student-credentials \\\n  -H \"Authorization: Bearer [admin-token]\" \\\n  -H \"x-user-role: admin\" \\\n  -H \"x-user-id: [admin-id]\"\n```\n\n## Frontend Deployment\n\n### 1. Build and Deploy\nThe frontend changes are already integrated. Build and deploy:\n\n```bash\nnpm run build\n```\n\n### 2. Verify Routes\nAccess the new routes:\n- Student Login: `http://localhost:5000/student/login`\n- Student Dashboard: `http://localhost:5000/student/dashboard` (requires login)\n\n## Admin Setup\n\n### 1. Access Student Credential Management\n1. Login as Admin\n2. Navigate to Admin → Master Data\n3. Look for \"Student Portal Management\" section\n4. Create credentials for students\n\n### 2. Create Student Credentials\n1. Click \"Create Credentials\"\n2. Select a student from dropdown\n3. Auto-generated username/password will appear\n4. Modify if needed\n5. Click \"Create Credentials\"\n6. Share credentials with student\n\n## Student Access\n\n### 1. Student Login Process\n1. Go to `http://[domain]/student/login`\n2. Enter username and password provided by admin\n3. Access dashboard with read-only views\n\n### 2. Available Features\n- **Profile**: View personal information, branch, program, batch\n- **Attendance**: View daily attendance, monthly summary, download reports\n- **Fees**: View payment history, pending amounts, fee summary\n- **Uniform**: Check uniform issue status\n\n## Security Features\n\n### 1. Authentication\n- Separate authentication system from staff\n- JWT-based session management\n- Automatic logout on session expiry\n\n### 2. Authorization\n- Read-only access to student's own data\n- Branch-level data isolation\n- No access to other students' information\n\n### 3. Data Protection\n- All APIs validate student identity\n- No sensitive data exposure\n- Secure password handling\n\n## Monitoring and Maintenance\n\n### 1. Monitor Student Logins\n```sql\n-- Check recent student logins\nSELECT \n  s.name,\n  spc.username,\n  spc.last_login,\n  spc.is_active\nFROM student_portal_credentials spc\nJOIN students s ON spc.student_id = s.id\nORDER BY spc.last_login DESC;\n```\n\n### 2. Manage Inactive Accounts\n```sql\n-- Deactivate credentials for inactive students\nUPDATE student_portal_credentials spc\nJOIN students s ON spc.student_id = s.id\nSET spc.is_active = FALSE\nWHERE s.status != 'active';\n```\n\n### 3. Regular Cleanup\n```sql\n-- Remove credentials for deleted students\nDELETE spc FROM student_portal_credentials spc\nLEFT JOIN students s ON spc.student_id = s.id\nWHERE s.id IS NULL;\n```\n\n## Troubleshooting\n\n### 1. Student Cannot Login\n- Verify credentials exist in `student_portal_credentials`\n- Check `is_active` status\n- Verify student status is 'active'\n- Check username/password match\n\n### 2. Data Not Loading\n- Verify student authentication headers\n- Check database connections\n- Review server logs for API errors\n\n### 3. Permission Issues\n- Ensure student has valid session\n- Verify student ID in headers\n- Check branch-level access restrictions\n\n## Rollback Plan\n\nIf issues occur, rollback safely:\n\n### 1. Database Rollback\n```sql\n-- Remove student portal tables\nDROP TABLE IF EXISTS student_portal_credentials;\nDROP TABLE IF EXISTS student_uniforms;\n```\n\n### 2. Code Rollback\n- Remove student routes from `App.tsx`\n- Remove student portal link from `Login.tsx`\n- Restart server\n\n### 3. Verification\n- Ensure existing functionality works\n- Test staff login and operations\n- Verify no broken links or errors\n\n## Success Criteria\n\n✅ **Database Tables Created**: `student_portal_credentials`, `student_uniforms`\n✅ **APIs Working**: Student login, profile, attendance, fees\n✅ **Admin Interface**: Can create/manage student credentials\n✅ **Student Access**: Can login and view read-only data\n✅ **Security**: No access to other students' data\n✅ **Existing System**: No impact on staff functionality\n\n## Support\n\nFor issues or questions:\n1. Check server logs for errors\n2. Verify database table structure\n3. Test API endpoints individually\n4. Review authentication flow\n\n---\n\n**IMPORTANT**: This implementation follows all specified requirements:\n- ✅ Zero changes to existing UI/database structure\n- ✅ Read-only student access\n- ✅ Admin-managed credentials\n- ✅ Isolated student portal module\n- ✅ Safe deployment with rollback options